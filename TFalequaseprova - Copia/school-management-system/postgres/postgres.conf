# Configurações do PostgreSQL para Sistema de Gestão Escolar
# PostgreSQL configuration settings for School Management System

# ========================================
# CONFIGURAÇÕES DE CONEXÃO / CONNECTION SETTINGS
# ========================================
listen_addresses = '*'
port = 5432
max_connections = 100
superuser_reserved_connections = 3

# ========================================
# CONFIGURAÇÕES DE MEMÓRIA / MEMORY SETTINGS
# ========================================
shared_buffers = 256MB
work_mem = 4MB
maintenance_work_mem = 64MB
effective_cache_size = 512MB
random_page_cost = 1.1

# ========================================
# CONFIGURAÇÕES DE ESCRITA / WRITE SETTINGS
# ========================================
wal_buffers = 16MB
checkpoint_completion_target = 0.7
max_wal_size = 1GB
min_wal_size = 80MB

# ========================================
# CONFIGURAÇÕES DE LOGGING / LOGGING SETTINGS
# ========================================
log_destination = 'stderr'
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_file_mode = 0600
log_rotation_age = 1d
log_rotation_size = 100MB
log_truncate_on_rotation = on

# Configurações de log mais adequadas para produção
log_statement = 'ddl'  # Mudança: apenas DDL em vez de 'all'
log_min_error_statement = error
log_min_messages = warning
log_min_duration_statement = 1000  # Log queries > 1 segundo
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on

# ========================================
# CONFIGURAÇÕES DE TIMEOUT / TIMEOUT SETTINGS
# ========================================
statement_timeout = 30s  # Reduzido para 30s
idle_in_transaction_session_timeout = 10min
lock_timeout = 30s
tcp_keepalives_idle = 600
tcp_keepalives_interval = 30
tcp_keepalives_count = 3

# ========================================
# CONFIGURAÇÕES REGIONAIS BRASILEIRAS / BRAZILIAN LOCALE SETTINGS
# ========================================
timezone = 'America/Sao_Paulo'  # Mudança: timezone brasileiro
datestyle = 'iso, dmy'  # Mudança: formato brasileiro DD/MM/YYYY
lc_messages = 'pt_BR.UTF-8'  # Mudança: português brasileiro
lc_monetary = 'pt_BR.UTF-8'  # Mudança: formato monetário brasileiro
lc_numeric = 'pt_BR.UTF-8'   # Mudança: formato numérico brasileiro
lc_time = 'pt_BR.UTF-8'      # Mudança: formato de data/hora brasileiro

# ========================================
# CONFIGURAÇÕES DE SEGURANÇA / SECURITY SETTINGS
# ========================================
ssl = off  # Para desenvolvimento - ativar em produção
password_encryption = scram-sha-256
row_security = on

# ========================================
# CONFIGURAÇÕES DE PERFORMANCE / PERFORMANCE SETTINGS
# ========================================
default_statistics_target = 100
constraint_exclusion = partition
cpu_tuple_cost = 0.01
cpu_index_tuple_cost = 0.005
cpu_operator_cost = 0.0025

# ========================================
# CONFIGURAÇÕES ESPECÍFICAS PARA ESCOLA / SCHOOL-SPECIFIC SETTINGS
# ========================================
# Configurações otimizadas para um sistema escolar com:
# - Consultas frequentes de alunos e turmas
# - Relatórios de frequência
# - Backup diário

# Configurações de autovacuum (limpeza automática)
autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50

# Configurações para relatórios
enable_hashjoin = on
enable_mergejoin = on
enable_nestloop = on
enable_seqscan = on
enable_sort = on

# ========================================
# CONFIGURAÇÕES DE BACKUP / BACKUP SETTINGS
# ========================================
archive_mode = on
archive_command = 'cp %p /var/lib/postgresql/archive/%f'
max_wal_senders = 3
wal_level = replica

# ========================================
# CONFIGURAÇÕES DE MONITORAMENTO / MONITORING SETTINGS
# ========================================
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all
stats_temp_directory = '/var/run/postgresql/stats_temp'

# Configurações para pg_stat_statements (análise de queries)
shared_preload_libraries = 'pg_stat_statements'
pg_stat_statements.max = 10000
pg_stat_statements.track = all
pg_stat_statements.save = on

# ========================================
# CONFIGURAÇÕES CUSTOMIZADAS / CUSTOM SETTINGS
# ========================================
# Configurações específicas para o sistema escolar
custom_variable_classes = 'escola'

# Configuração de encoding padrão
default_text_search_config = 'pg_catalog.portuguese'
